Title: Клерк
Date: 7 Jun 2016 6:00

<img src="/img/clerk.png" width="75">

[Клерк](http://github.com/vanya-klimenko/clerk) - псевдостатический движок для блога, написанный на Ноде. Он собирает текстовые файлы с маркдауновой разметкой в сайт.

Я три года мечтал о движке, который спокойно бы ел текст из дропбокса и делал из них статические страницы без гитхаба, сложной настройки и ненужных функций.
  
Как и в реальном мире, Клерк получает стопку черновиков на входе и отдаёт документ на выходе.
  
# Работает быстрее Эгеи и Вордпресса
Клерк собирает сайт раз в пятнадцать минут, а не при каждом обращении. Сервер нагружается меньше и обрабатывает запросы моментально: у него всё уже готово. Он не развалится, даже если у вас два миллиона заметок.
  
# Не теряет заметки
У Клерка нет базы данных, которая может сломаться. Посты хранятся в текстовых файлах. Переезд на другой движок тоже не проблема.
  
# Прогибается подо всех
Если вы хоть немного разбираетесь в вёрстке, настроить блог по вкусу - дело получаса. Настраивать нечего: стили, шаблоны шапки, футера и заголовка поста, из которых он компонует сайт.
  
Любители экзотики тоже рады: к движку можно прикручивать плагины из npm.
  
# Установка и настройка
1. Склонируйте репозиторий: `git clone https://github.com/vanya-klimenko/clerk.git`.
2. Настройте зависимости: `npm install`.
3. Настройте сервер-туннель из интернета на локалхост: `cd /etc/nginx`, `nano sites-available/clerk.conf`. Конфиг должен выглядеть так:
```
server {
    listen 80;
    server_name IP-адрес или домен ;

    location / {
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   Host      $http_host;
        proxy_pass         http://127.0.0.1:5000;
    }
}
```
4. Включите сервер с только что созданным конфигом: `cp sites-available/blog.conf sites-enabled/clerk.conf`, `service nginx restart`.
Отредактируйте файл templates/defaultTags.html - в нём указывается адрес хоста и название блога.

# Настройка
Шаблоны вёрстки в папке templates написаны на Хэндлбарсе. Стили, скрипты, изображения и прочие мультимедиа, к которым нужен доступ из интернета - в public.

# Создание заметок
Чтобы создать заметку воспользуйтесь текстовым редактором, а затем сохраните её в формате txt. Работает продвинутый маркдаун: вставляйте картинки, заголовки и ссылки.

В начале поста всегда есть такие теги, чтобы движок знал, как сортировать заметки:
```
Title: Заголовок заметки
Date: 18 Feb 2016
Link: http://ya.ru

А тут у меня текст заметки.
```
  
Тег Link необязателен. Он превращает пост в заметку-ссылку, у которой заголовок ведёт на внешний сайт, как у Грубера.
   
Чтобы посмотреть заранее, как выглядит заметка, закиньте её в posts/drafts. Чтобы опубликовать, переместите в posts. Имя файла — адрес заметки. Если что-то сломается, почиcтите кэш (/flush) и проверьте, работает ли на сервере inotify.
  
# Приколы
1. К папке posts можно создать симолическую ссылку из дропбокса и писать в блог с айфона или картошки. Попробуйте Райтер.
2. Все страницы типографятся. В следующем релизе появится висячая пунктуация.  
3. Вы можете изменить страницу 404 или главную - они лежат в posts, но удалять их - не очень идея, скажу вам.
4. Работает РСС.
5. Попробуйте добавить `.txt` к адресу этой страницы.
  
# Косяки
1. Навигация по страницам может сломаться.
2. Дата выводится по-русски, но не словами, как хотелось бы.
3. Нет встроенного поиска (можно прикрутить гугловый) и тегов (не появятся).

Четвёртый косяк и далее пока неизвестны. Пишите на почту, если вдруг обнаружите: <a href="mailto:v@vanyaklimenko.ru">v@vanyaklimenko.ru</a>.
